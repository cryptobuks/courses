import { __decorate } from "tslib";
import { bind } from '@roots/bud-support/decorators';
import { isFunction, isUndefined } from '@roots/bud-support/lodash-es';
import Hooks from './base.js';
/**
 * Asynchronous hooks registry
 *
 * @public
 */
export default class Async extends Hooks {
    /**
     * Set a value
     *
     * @public
     * @decorator `@bind`
     */
    set(id, input) {
        if (this.has(id) && isFunction(input)) {
            this.store[id].push(this.app.value.make(input));
        }
        else {
            this.store[id] = [this.app.value.make(input)];
        }
        return this.app;
    }
    /**
     * Set multiple values
     *
     * @public
     * @decorator `@bind`
     */
    setRecords(map) {
        Object.entries(map).map(([k, v]) => this.set(k, v));
        return this.app;
    }
    /**
     * Get a value
     *
     * @public
     * @decorator `@bind`
     */
    async get(id, fallback) {
        if (isUndefined(this.store[id]))
            return fallback;
        const result = await this.store[id]
            .map(this.app.value.get)
            .reduce(async (accumulated, current) => {
            const thisValue = await accumulated;
            return isFunction(current) ? await current(thisValue) : current;
        }, fallback);
        return result;
    }
}
__decorate([
    bind
], Async.prototype, "set", null);
__decorate([
    bind
], Async.prototype, "setRecords", null);
__decorate([
    bind
], Async.prototype, "get", null);
//# sourceMappingURL=async.js.map