import { __decorate } from "tslib";
import { bind } from '@roots/bud-support/decorators';
import * as fs from '@roots/bud-support/fs';
import { omit } from '@roots/bud-support/lodash-es';
/**
 * ThemeJSONWebpackPlugin
 *
 * @public
 */
export class ThemeJsonWebpackPlugin {
    /**
     * Class constructor
     *
     * @param options - Plugin options
     *
     * @public
     */
    constructor(options) {
        this.options = options;
    }
    /**
     * theme.json path
     *
     * @public
     */
    get path() {
        return this.options.path;
    }
    /**
     * theme.json settings
     *
     * @public
     */
    get settings() {
        return JSON.stringify({
            __generated__: `⚠️ This file is generated. Do not edit.`,
            $schema: `https://schemas.wp.org/trunk/theme.json`,
            version: 2,
            ...omit(this.options, `path`),
        }, null, 2);
    }
    /**
     * Apply plugin
     *
     * @param compiler - Webpack compiler
     * @returns void
     *
     * @public
     * @decorator `@bind`
     */
    apply(compiler) {
        compiler.hooks.done.tapPromise(this.constructor.name, this.done);
    }
    /**
     * Compiler done
     *
     * @returns Promise
     *
     * @public
     * @decorator `@bind`
     */
    async done() {
        try {
            await fs.writeFile(this.path, this.settings, `utf8`);
        }
        catch (err) {
            throw new Error(err);
        }
    }
}
__decorate([
    bind
], ThemeJsonWebpackPlugin.prototype, "apply", null);
__decorate([
    bind
], ThemeJsonWebpackPlugin.prototype, "done", null);
